<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIXI Star Warp</title>

    <link rel="stylesheet" href="/common/css/common.css">
</head>

<body>
    <div class="pixi-navigation">
        <div class="pixi-navigation__button-wrap">
            <button type="button" class="pixi-navigation__button">
                <div class="pixi-navigation__bar-wrap">
                    <div class="pixi-navigation__bar bar1"></div>
                    <div class="pixi-navigation__bar bar2"></div>
                    <div class="pixi-navigation__bar bar3"></div>
                    <div class="pixi-navigation__bar bar4"></div>
                </div>
            </button>
        </div>
        <div class="pixi-navigation__content">
            <div class="pixi-navigation__content-wrap">
                <div class="pixi-navigation__content-title">Basic</div>
                <ul class="pixi-navigation__content-list">
                    <li class="pixi-navigation__content-list--item" data-content="container">
                        <a href="/example/basic/container">Container</a>
                    </li>
                    <li class="pixi-navigation__content-list--item" data-content="particle-container">
                        <a href="/example/basic/particle-container">Particle Container</a>
                    </li>
                    <li class="pixi-navigation__content-list--item" data-content="tinting">
                        <a href="/example/basic/tinting">Tinting</a>
                    </li>
                    <li class="pixi-navigation__content-list--item" data-content="simple-plane">
                        <a href="/example/basic/simple-plane">Simple Plane</a>
                    </li>
                </ul>
            </div>
            <div class="pixi-navigation__content-wrap">
                <div class="pixi-navigation__content-title">Advanced</div>
                <ul class="pixi-navigation__content-list">
                    <li class="pixi-navigation__content-list--item" data-content="slots">
                        <a href="/example/advanced/slots">Slots</a>
                    </li>
                    <li class="pixi-navigation__content-list--item" data-content="scratchcard">
                        <a href="/example/advanced/scratchcard">Scratch Card</a>
                    </li>
                    <li class="pixi-navigation__content-list--item" data-content="mouse-trail">
                        <a href="/example/advanced/mouse-trail">Mouse Trail</a>
                    </li>
                    <li class="pixi-navigation__content-list--item" data-content="starwarp">
                        <a href="/example/advanced/starwarp">Star Warp</a>
                    </li>
                </ul>
            </div>
            <div class="pixi-navigation__content-wrap">
                <div class="pixi-navigation__content-title">Documents</div>
                <ul class="pixi-navigation__content-list">
                    <li class="pixi-navigation__content-list--item" data-content="total-document">
                        <a href="/example/document/total-document">Documents</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="pixi-navigation__logo">HJ</div>
    </div>
    <section class="pixi pixi-starwarp">
        <div class="pixi-controller">
            <div class="pixi-controller__title">
                PIXI Star Warp
            </div>
            <hr>
            <div class="pixi-controller__container">
                <div class="pixi-controller__canvas">
                    <canvas id="starwarp" width="800" height="800"></canvas>
                </div>
            </div>
            <div class="pixi-title">Example Code</div>
            <pre class="pixi-controller__codeblock"><code>
;(function() {
    'use strict';

    window.pixi = window.pixi || {};
    window.pixi.component = window.pixi.component || {};

    pixi.component.starwarp = (function() {
        var obj = {};

        var init = function() {
            obj.section = document.querySelector('.pixi-starwarp');

            if (!!obj.section) {
                setElements();
                createStars();
                setTicker();
                bindEvents();
            }
        };

        var setElements = function() {
            obj.app = new PIXI.Application({
                view: document.getElementById('starwarp')
            });
            obj.starTexture = PIXI.Texture.from('/content/images/star.png');

            obj.stars = [];
            obj.starAmount = 1000;
            obj.cameraZ = 0;
            obj.fov = 20;
            obj.baseSpeed = 0.025;
            obj.speed = 0;
            obj.warpSpeed = 0;
            obj.starStretch = 5;
            obj.starBaseSize = 0.05;

            setInterval(() => {
                obj.warpSpeed = obj.warpSpeed > 0 ? 0 : 1;
            }, 3000);
        };

        var createStars = function() {
            for (var i = 0; i < obj.starAmount; i++) {
                var star = {
                    sprite: new PIXI.Sprite(obj.starTexture),
                    x: 0,
                    y: 0,
                    z: 0
                };

                star.sprite.anchor.x = 0.5;
                star.sprite.anchor.y = 0.7;
                randomizeStar(star, true);
                obj.app.stage.addChild(star.sprite);
                obj.stars.push(star);
            }
        };

        var randomizeStar = function(star, initial) {
            star.z = initial ? Math.random() * 2000 : obj.cameraZ + (Math.random() * 1000) + 2000;

            var deg = Math.random() * Math.PI * 2;
            var distance = Math.random() * 50 + 1;
            star.x = Math.cos(deg) * distance;
            star.y = Math.sin(deg) * distance;
        };

        var setTicker = function() {
            obj.app.ticker.add(function(delta) {
                obj.speed += (obj.warpSpeed - obj.speed) / 20;
                obj.cameraZ += delta * 10 * (obj.speed + obj.baseSpeed);

                for (var i = 0; i < obj.starAmount; i++) {
                    var star = obj.stars[i];
                    if (star.z < obj.cameraZ) randomizeStar(star);

                    var z = star.z - obj.cameraZ;
                    star.sprite.x = star.x * obj.fov / z * obj.app.renderer.screen.width + obj.app.renderer.screen.width / 2;
                    star.sprite.y = star.y * obj.fov / z * obj.app.renderer.screen.width + obj.app.renderer.screen.height / 2;

                    var dxCenter = star.sprite.x - (obj.app.renderer.screen.width / 2);
                    var dyCenter = star.sprite.y - (obj.app.renderer.screen.height / 2);
                    var distanceCenter = Math.sqrt((dxCenter * dxCenter) + (dyCenter * dyCenter));
                    var distanceScale = Math.max(0, (2000 - z) / 2000);
                    star.sprite.scale.x = distanceScale * obj.starBaseSize;
                    star.sprite.scale.y = (distanceScale * obj.starBaseSize) + distanceScale * obj.speed * obj.starStretch * distanceCenter / obj.app.renderer.screen.width;
                    star.sprite.rotation = Math.atan2(dyCenter, dxCenter) + Math.PI / 2;
                }
            });
        };

        var bindEvents = function() {

        };

        return {
            init: init
        }
    })();

    pixi.component.starwarp.init();
})();
              </code></pre>
            <hr>
        </div>
        <div class="pixi-wrap pixi-link-display-object">
            <div class="pixi-accordion">
                <a id="pixi-display-object" href="/example/basic/container#pixi-display-object"
                    class="pixi-accordion__title has-content">
                    PIXI.DisplayObject
                    <span class="pixi-accordion__title-window">
                        <svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 96 96">
                            <path
                                d="M81.436 14.564v54.285h-8V28.221L18.22 83.436l-5.656-5.656L67.78 22.563l-40.629.001v-8z">
                            </path>
                        </svg>
                    </span>
                </a>
            </div>
            <hr>
        </div>
        <div class="pixi-wrap pixi-link-application">
            <div class="pixi-accordion">
                <a id="pixi-application" href="/example/basic/container#pixi-application"
                    class="pixi-accordion__title">
                    PIXI.Application
                    <span class="pixi-accordion__title-window">
                        <svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 96 96">
                            <path
                                d="M81.436 14.564v54.285h-8V28.221L18.22 83.436l-5.656-5.656L67.78 22.563l-40.629.001v-8z">
                            </path>
                        </svg>
                    </span>
                </a>
            </div>
            <hr>
        </div>
        <div class="pixi-wrap pixi-link-texture">
            <div class="pixi-accordion">
                <a id="pixi-texture" href="/example/basic/container#pixi-texture" class="pixi-accordion__title">
                    PIXI.Texture
                    <span class="pixi-accordion__title-window">
                        <svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 96 96">
                            <path
                                d="M81.436 14.564v54.285h-8V28.221L18.22 83.436l-5.656-5.656L67.78 22.563l-40.629.001v-8z">
                            </path>
                        </svg>
                    </span>
                </a>
            </div>
            <hr>
        </div>
        <div class="pixi-wrap pixi-link-spite">
            <div class="pixi-accordion">
                <a id="pixi-sprite" href="/example/basic/container#pixi-sprite" class="pixi-accordion__title">
                    PIXI.Sprite
                    <span class="pixi-accordion__title-window">
                        <svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 96 96">
                            <path
                                d="M81.436 14.564v54.285h-8V28.221L18.22 83.436l-5.656-5.656L67.78 22.563l-40.629.001v-8z">
                            </path>
                        </svg>
                    </span>
                </a>
            </div>
            <hr>
        </div>
    </section>

    <script src="/common/js/pixi.js"></script>
    <script src="/common/js/pixi-spine.js"></script>
    <script src="/common/js/common.js"></script>
    <script src="./component.js"></script>
</body>

</html>